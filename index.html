<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Training Feedback Form</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
}
.container{
    max-width:600px;
    margin:40px auto;
    background:#fff;
    padding:25px;
    border-radius:8px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}
h2{
    text-align:center;
}
label{
    font-weight:bold;
    margin-top:10px;
    display:block;
}
input, select, button{
    width:100%;
    padding:10px;
    margin-top:5px;
}
.question{
    margin-top:15px;
}
button{
    background:#0b5ed7;
    color:white;
    border:none;
    cursor:pointer;
    margin-top:20px;
}
button:hover{
    background:#084298;
}
.success{
    color:green;
    text-align:center;
}
.error{
    color:red;
    text-align:center;
}
</style>
</head>

<body>
<div class="container">
<h2>Training Feedback Form</h2>

<form id="feedbackForm">

<label>Name</label>
<input type="text" name="name" required>

<label>Department</label>
<input type="text" name="department" required>

<label>Designation</label>
<input type="text" name="designation" required>

<label>Email</label>
<input type="email" name="email" required>

<label>Training</label>
<select name="training" id="trainingSelect" required>
<option value="">Loading trainings...</option>
</select>

<div id="questions"></div>

<button type="submit">Submit Feedback</button>
</form>

<p id="msg"></p>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwlaszm-Yjx5U7T-zGJUkoY06rXi8hIK-cGRqmUotFJjpTa5PAAXKCxFEk1im1IFKe8Ig/exec";

/* Load Trainings */
fetch(SCRIPT_URL + "?action=getTrainings")
.then(res => res.json())
.then(data => {
    const sel = document.getElementById("trainingSelect");
    sel.innerHTML = '<option value="">Select Training</option>';
    data.forEach(t => {
        sel.innerHTML += `<option value="${t}">${t}</option>`;
    });
})
.catch(() => {
    document.getElementById("trainingSelect").innerHTML =
        '<option value="">Failed to load trainings</option>';
});

/* Load Questions on training change */
document.getElementById("trainingSelect").addEventListener("change", function(){
    const training = this.value;
    if(!training) return;

    fetch(SCRIPT_URL + "?action=getQuestions&training=" + encodeURIComponent(training))
    .then(res => res.json())
    .then(qs => {
        const div = document.getElementById("questions");
        div.innerHTML = "";
        qs.forEach(q => {
            div.innerHTML += `
            <div class="question">
                <label>${q.text}</label>
                <input type="text" name="q_${q.id}" required>
            </div>`;
        });
    });
});

/* Submit Form */
document.getElementById("feedbackForm").addEventListener("submit", function(e){
    e.preventDefault();

    const formData = new FormData(this);

    fetch(SCRIPT_URL, {
        method: "POST",
        body: formData
    })
    .then(res => res.text())
    .then(() => {
        document.getElementById("msg").innerHTML =
            "<p class='success'>Feedback submitted successfully</p>";
        this.reset();
        document.getElementById("questions").innerHTML="";
    })
    .catch(err => {
        document.getElementById("msg").innerHTML =
            "<p class='error'>Submission failed</p>";
        console.error(err);
    });
});
</script>

</body>
</html>