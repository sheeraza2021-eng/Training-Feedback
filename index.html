<!DOCTYPE html>
<html>
<head>
  <title>Training Registration & Feedback Form</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f9fc; }
    h2 { color: #0d47a1; text-align: center; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select, textarea {
      width: 100%; padding: 8px; margin-top: 5px;
      border-radius: 5px; border: 1px solid #ccc;
    }
    .question { margin-top: 10px; }
    button {
      margin-top: 20px; background: #0d47a1; color: #fff;
      padding: 10px; border: none; border-radius: 5px;
      width: 100%; font-size: 16px; cursor: pointer;
    }
    button:hover { background: #1565c0; }
    .message { margin-top: 15px; text-align: center; font-weight: bold; }
  </style>
</head>
<body>

<h2>Training Registration & Feedback Form</h2>

<form id="form">
  <label>Name</label>
  <input type="text" id="name" required>

  <label>Email</label>
  <input type="email" id="email" required>

  <label>Department</label>
  <input type="text" id="department" required>

  <label>Designation</label>
  <input type="text" id="designation">

  <label>Training Name</label>
  <select id="training" required>
    <option value="">Loading trainings...</option>
  </select>

  <div id="questions"></div>

  <button type="submit">Submit</button>
  <div class="message" id="msg"></div>
</form>

<script>
/* ðŸ”´ ONLY THIS URL IS USED */
const WEB_APP_URL =
"https://script.google.com/macros/s/AKfycbwz2p5lDMTaC7OF65tPcrD0enYrdE9GeCkLPphU9irjiDm0275KlsylnsU1xWHFVj9hrQ/exec";

/* Load Trainings */
fetch(WEB_APP_URL + "?action=getTrainings")
  .then(r => r.json())
  .then(data => {
    const sel = document.getElementById("training");
    sel.innerHTML = '<option value="">-- Select Training --</option>';
    data.forEach(t => {
      const o = document.createElement("option");
      o.value = t.Training_Name;
      o.textContent = t.Training_Name;
      sel.appendChild(o);
    });
  })
  .catch(() => {
    document.getElementById("msg").innerText = "Failed to load trainings";
  });

/* Load Questions */
document.getElementById("training").addEventListener("change", function () {
  const training = this.value;
  const box = document.getElementById("questions");
  box.innerHTML = "";

  if (!training) return;

  fetch(WEB_APP_URL + "?action=getQuestions&training=" + encodeURIComponent(training))
    .then(r => r.json())
    .then(data => {
      data.forEach(q => {
        const d = document.createElement("div");
        d.className = "question";

        if (q.Question_Type === "Rating") {
          d.innerHTML = `
            <label>${q.Question_Text}</label>
            <select data-id="${q.Question_ID}" required>
              <option value="">Select</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>`;
        } else {
          d.innerHTML = `
            <label>${q.Question_Text}</label>
            <textarea data-id="${q.Question_ID}" required></textarea>`;
        }
        box.appendChild(d);
      });
    });
});

/* Submit Form */
document.getElementById("form").addEventListener("submit", function (e) {
  e.preventDefault();

  const feedback = [];
  document.querySelectorAll("#questions select, #questions textarea")
    .forEach(el => {
      feedback.push({
        id: el.dataset.id,
        answer: el.value
      });
    });

  const payload = {
    name: name.value,
    email: email.value,
    department: department.value,
    designation: designation.value,
    training: training.value,
    feedback: feedback
  };

  document.getElementById("msg").innerText = "Submitting...";

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(r => r.text())
  .then(t => {
    document.getElementById("msg").innerText = t;
    if (t.includes("âœ”")) {
      document.getElementById("form").reset();
      document.getElementById("questions").innerHTML = "";
    }
  })
  .catch(() => {
    document.getElementById("msg").innerText = "Submission failed";
  });
});
</script>

</body>
</html>