<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    h1 { margin-bottom:20px; }
    form { max-width:400px; margin:auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    label { display:block; margin-bottom:8px; font-weight:bold; }
    input { width:100%; padding:10px; margin-bottom:15px; border:1px solid #ccc; border-radius:6px; }
    button { width:100%; padding:10px; background:#2563eb; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    button:hover { background:#1e4fc3; }
    .error { color:red; margin-top:10px; }
  </style>
</head>
<body>
  <h1>Institution Login</h1>
  <form id="loginForm">
    <label for="username">Username</label>
    <input type="text" id="username" required />
    <label for="password">Password</label>
    <input type="password" id="password" required />
    <button type="submit">Login</button>
    <div id="error" class="error"></div>
  </form>

  <script>
    // âœ… Flow A (Login) endpoint
    const LOGIN_ENDPOINT = "https://default12b221b30464422389e5888835778b.58.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/<<YOUR-FLOW-A-ID>>/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=<<YOUR-SIG>>";

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      try {
        const res = await fetch(LOGIN_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ Username: username, Password: password })
        });
        const data = await res.json();

        if (data.status === "ok") {
          // Save user info in session
          sessionStorage.setItem("user", JSON.stringify(data.user));

          // Redirect based on role
          if (data.user.Role === "Dean") {
            location.href = "dean.html";
          } else if (data.user.Role === "Faculty") {
            location.href = "faculty.html"; // optional future page
          } else {
            document.getElementById("error").textContent = "Unauthorized role.";
          }
        } else {
          document.getElementById("error").textContent = "Invalid login.";
        }
      } catch (err) {
        document.getElementById("error").textContent = "Network error: " + err;
      }
    });
  </script>
</body>
</html>
